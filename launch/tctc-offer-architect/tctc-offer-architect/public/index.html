<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TCTC Offer Architect</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            tctc: {
              primary: 'var(--bg-primary)',
              secondary: 'var(--bg-secondary)',
              textMain: 'var(--text-primary)',
              textSub: 'var(--text-secondary)',
              accent: 'var(--text-accent)',
              border: 'var(--border-color)',
              gold: '#D4AF37',
              goldHover: '#F4CF57',
            }
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            serif: ['Merriweather', 'serif'],
            mono: ['JetBrains Mono', 'monospace'],
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Merriweather:ital,wght@0,300;0,700;1,300&family=JetBrains+Mono:wght@400&display=swap');
    
    :root {
      /* Dark Mode (Night) - Default */
      --bg-primary: #1a0a0a;       
      --bg-secondary: #0f0606;     
      --text-primary: #F0F0F0;     
      --text-secondary: #C0C0C0;   
      --text-accent: #D4AF37;      
      --border-color: #3D1111;     
    }

    body {
      background-color: var(--bg-primary);
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      background-image: radial-gradient(circle at 50% 0%, rgba(212, 175, 55, 0.03) 0%, transparent 70%);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .module-frame {
      background-color: var(--bg-primary);
      border: 1px solid var(--border-color);
      box-shadow: 0 0 60px rgba(0,0,0,0.9);
    }

    .architect-input {
      width: 100%;
      min-height: 120px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      padding: 16px;
      border-radius: 4px;
      transition: all 0.3s ease;
      resize: none;
      font-family: 'Inter', sans-serif;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .architect-input:focus {
      border-color: var(--text-accent);
      outline: none;
      background: #140808; 
      box-shadow: 0 0 0 1px rgba(212, 175, 55, 0.2);
    }

    .architect-input::placeholder {
      color: var(--text-secondary);
      opacity: 0.5;
      font-style: italic;
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-primary); }
    ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-accent); }

    .btn-gold {
      background: linear-gradient(135deg, #D4AF37 0%, #C5A028 100%);
      color: #050505;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.2s ease;
      border: 1px solid #F4CF57;
    }
    .btn-gold:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
      filter: brightness(1.1);
    }

    .btn-secondary {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      transition: all 0.2s;
    }
    .btn-secondary:hover {
      border-color: var(--text-accent);
      color: var(--text-accent);
      background: var(--bg-primary);
    }

    .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .loader {
      border: 2px solid var(--border-color);
      border-top: 2px solid var(--text-accent);
      border-radius: 50%;
      width: 18px;
      height: 18px;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* --- PARCHMENT STYLING --- */
    .parchment-box {
      background-color: #F4ECD8; 
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
      color: #1A0F08; 
      border: 1px solid #C9B896;
      box-shadow: inset 0 0 60px rgba(61, 40, 23, 0.15), 0 10px 30px rgba(0,0,0,0.5); 
      position: relative;
      overflow: hidden;
    }
    
    .parchment-text {
      font-family: 'Merriweather', serif;
      line-height: 1.7;
      color: #1A0F08;
      text-shadow: 0 0 1px rgba(61, 40, 23, 0.1); 
    }
    
    .btn-ink {
      background: transparent;
      border: 1px solid #3D2817;
      color: #3D2817;
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      transition: all 0.2s;
    }
    .btn-ink:hover {
      background: #3D2817;
      color: #F4ECD8;
    }
    
    .card-bg {
        background-color: var(--bg-secondary);
        border: 1px solid var(--border-color);
    }

    /* --- ANIMATIONS --- */
    @keyframes forgeBlast {
      0% { background-color: #000; border-color: #3D1111; box-shadow: 0 0 0 rgba(0,0,0,0); opacity: 0; transform: scale(0.95); filter: brightness(0); }
      15% { opacity: 1; background-color: #2b1d0e; transform: scale(0.98); }
      40% { background-color: #fffbe8; border-color: #fff; box-shadow: 0 0 80px 20px rgba(255, 255, 255, 0.9), 0 0 150px 50px rgba(212, 175, 55, 0.8), inset 0 0 60px rgba(255, 215, 0, 0.5); transform: scale(1.02); filter: brightness(1.5) contrast(1.2); }
      60% { background-color: #fceeb5; border-color: #F4CF57; box-shadow: 0 0 50px 10px rgba(212, 175, 55, 0.5), inset 0 0 30px rgba(212, 175, 55, 0.3); transform: scale(1.01); filter: brightness(1.1); }
      100% { background-color: #F4ECD8; border-color: #C9B896; box-shadow: inset 0 0 60px rgba(61, 40, 23, 0.15), 0 10px 30px rgba(0,0,0,0.5); transform: scale(1); filter: brightness(1); }
    }

    @keyframes coolingCoal {
      0% { color: #ffffff; text-shadow: 0 0 4px #ffffff, 0 0 10px #ff9d00, 0 0 20px #ff4500; opacity: 1; }
      15% { color: #ffcc00; text-shadow: 0 0 4px #ff9d00, 0 0 8px #ff4500; }
      40% { color: #ff4500; text-shadow: 0 0 2px #ff4500, 0 0 5px #8b0000; }
      100% { color: #1A0F08; text-shadow: none; }
    }
    .ember-text { animation: coolingCoal 2s ease-out forwards; display: inline; }

    @keyframes shockwave {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; border-width: 100px; }
      20% { opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; border-width: 0; }
    }

    .magical-reveal { animation: forgeBlast 2.5s cubic-bezier(0.22, 1, 0.36, 1) forwards; position: relative; overflow: hidden; }
    .magical-reveal::after { content: ''; position: absolute; top: 50%; left: 50%; width: 100%; height: 100%; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.8); box-shadow: 0 0 50px rgba(255, 215, 0, 0.8); transform: translate(-50%, -50%) scale(0); animation: shockwave 1s ease-out 0.6s forwards; pointer-events: none; z-index: 20; }
  </style>
</head>

<body class="flex flex-col items-center min-h-screen p-4 md:p-8">

  <!-- --- SVG DEFINITION: TCTC LOGO (Hidden, reused via <use>) --- -->
  <svg style="display: none;">
    <symbol id="tctc-logo" viewBox="0 0 665 665">
        <g>
            <path style="fill:#d4af37;fill-opacity:1" d="M 317.29402,591.92951 C 263.13593,588.47179 215.0218,570.13816 171,536.18495 160.09882,527.77707 136.53734,504.23956 126.77004,492 97.126507,454.8532 78.067599,408.93133 72.484133,361.19972 70.746634,346.34629 70.542355,315.99754 72.075047,300.42368 80.327817,216.56634 130.00778,141.83402 205.53781,99.65901 257.01644,70.913992 323.84364,61.50743 387,74.116486 c 40.41415,8.068613 78.31416,25.944644 111.5,52.590434 12.67705,10.17873 33.77061,31.90807 43.5,44.81111 25.79697,34.21175 42.76721,75.61263 49.67042,121.17678 2.36564,15.61429 2.34778,56.54423 -0.0318,72.80519 -6.54868,44.75115 -23.23918,86.02393 -48.1376,119.03613 -35.86223,47.54886 -82.20305,80.33283 -137.05293,96.95858 -28.73514,8.71001 -59.59541,12.32197 -89.15409,10.4348 z M 359.5,588.9397 c 30.62761,-3.10863 65.67565,-13.8417 93.18105,-28.53566 28.24163,-15.08726 52.53798,-34.30925 73.58932,-58.21997 35.33998,-40.14019 54.73762,-81.67044 62.90721,-134.68407 3.0612,-19.86457 3.0965,-56.92672 0.0729,-76.51358 -4.86281,-31.50089 -13.79598,-58.59015 -28.25149,-85.67088 C 549.66401,184.08084 537.63821,167.79309 519.51371,149.1279 479.1299,107.53937 430.12684,82.694038 370,73.322085 355.43091,71.051205 309.5137,70.753783 295.5,72.839521 236.67986,81.594059 188.23947,105.57691 148.39567,145.67093 121.25002,172.98704 100.55708,205.22476 88.168093,239.5 83.408016,252.66918 77.657309,275.52656 75.462758,290 c -2.171431,14.32096 -3.017238,48.47839 -1.572388,63.5 4.257135,44.25996 18.344814,84.20345 42.32282,120 C 170.58364,554.66912 263.37066,598.6966 359.5,588.9397 Z M 315,578.92592 C 255.04921,574.83537 197.49792,547.92934 154.40841,503.84712 134.78665,483.77331 119.73725,462.58572 107.99278,438.5 96.164872,414.24316 89.328241,392.45696 85.398772,366.5 83.145051,351.61256 82.794954,311.38774 84.798231,297.5 92.000783,247.56821 110.38679,204.89197 139.72955,169.99748 195.52373,103.6469 277.61489,72.303238 366,83.603965 c 53.6785,6.863215 102.43107,30.415175 141.22589,68.225045 42.41915,41.34218 65.24034,88.5722 72.79521,150.65474 1.41447,11.62344 1.42987,43.47136 0.0266,55.01625 -7.16535,58.95074 -32.09678,110.07004 -73.18509,150.05845 -20.4185,19.8719 -41.16063,34.59653 -65.36262,46.40026 -30.70048,14.97315 -59.54865,22.77202 -92.57446,25.02677 -15.84992,1.08211 -17.22886,1.07969 -33.92554,-0.0596 z m 33.91908,-1.97933 C 410.74979,572.51424 466.9511,545.96834 511,500.38992 c 36.93642,-38.21896 59.20272,-85.07628 66.5058,-139.95519 1.92584,-14.47172 1.92106,-45.98172 -0.009,-61.13351 C 570.38017,243.44286 548.62488,197.21213 511.53949,159.14026 473.93996,120.54058 428.97526,96.709027 376,87.303535 356.32091,83.80961 320.05561,82.92561 299.87014,85.447799 237.52369,93.238031 183.91129,121.99938 143.19322,169.5 79.040396,244.33897 66.726795,356.79744 113.13845,443.98619 153.93032,520.61761 231.67031,571.43867 316.5,576.92997 c 17.56018,1.13673 16.79906,1.13634 32.41908,0.0166 z M 315,500.97445 c -11.18499,-1.5686 -25.57165,-5.67751 -34.45581,-9.84077 C 275.84488,488.93151 272,486.65055 272,486.06487 272,485.47919 272.16648,485 272.36996,485 c 2.26912,0 22.9842,-7.03907 30.67209,-10.4225 9.27106,-4.08018 10.21501,-4.3002 14.19473,-3.30853 7.53494,1.87756 28.18504,1.26433 38.03559,-1.12951 29.62533,-7.19945 53.35299,-24.17927 72.54939,-51.91729 10.65605,-15.39757 16.08736,-28.78773 18.70312,-46.11009 0.77969,-5.16335 1.65624,-9.62653 1.94788,-9.91817 1.14638,-1.14638 6.31384,2.7338 16.19637,12.16165 5.6922,5.4303 10.33087,10.67041 10.33087,11.67032 0,3.15801 -6.00734,19.10308 -11.03391,29.28691 -25.66784,52.00304 -74.35683,84.53478 -128.96609,86.16919 -7.425,0.22223 -16.425,-0.006 -20,-0.50753 z m 41.68841,-3.90928 c 12.43859,-2.53686 24.87064,-6.7827 36.81159,-12.57202 34.72745,-16.83687 62.70054,-49.46995 76.55728,-89.31084 l 3.24071,-9.31768 -5.399,-5.54154 c -2.96944,-3.04785 -8.05846,-7.78284 -11.30893,-10.52221 -6.69697,-5.64395 -6.95626,-5.53107 -8.04686,3.50332 -2.66932,22.11244 -15.391,45.53433 -36.01349,66.30448 -17.32491,17.44895 -32.56421,26.40492 -54.16466,31.83197 -12.79644,3.21507 -25.45625,4.1154 -36.89611,2.62394 l -9.03105,-1.17741 -6.96895,3.15912 c -3.83292,1.73752 -12.05531,4.84198 -18.27199,6.8988 l -11.30306,3.73968 7.09355,3.17178 c 21.53064,9.62713 48.77641,12.29201 73.70097,7.20861 z M 211,481.86092 c -15.89992,-0.80305 -25.29584,-2.59649 -41.12127,-7.84899 -12.99704,-4.31375 -22.72135,-8.93344 -33.96699,-16.13654 -11.8293,-7.57696 -11.5872,-7.10864 -9.56754,-18.50709 3.56371,-20.11273 12.97192,-43.84179 24.23117,-61.115 5.52258,-8.47239 22.69831,-27.2533 24.924,-27.2533 0.8067,0 1.42114,3.05972 1.85755,9.25 0.35867,5.0875 1.34159,13.19494 2.18426,18.01654 l 1.53214,8.76654 -2.90399,4.23346 c -7.25407,10.57505 -18.10705,34.18891 -19.67623,42.81143 -0.64984,3.57088 -0.63956,3.5831 5.17788,6.15691 8.32397,3.68277 23.4288,8.32406 33.32902,10.24108 25.17268,4.87428 65.71839,1.70395 88.48773,-6.91898 25.40853,-9.62242 55.06569,-31.6578 61.92832,-46.01297 4.4195,-9.24464 4.58769,-16.20631 0.63006,-26.07867 -5.90113,-14.72045 -5.31666,-20.7556 3.91329,-40.40743 6.8432,-14.57013 8.0274,-18.44738 8.03502,-26.30791 0.008,-7.82353 2.07995,-7.64752 5.88699,0.5 3.70926,7.93824 5.70205,14.92274 7.48954,26.25 0.78114,4.95 2.41215,13.5 3.62448,19 4.14658,18.81185 1.76879,37.09739 -7.12263,54.77416 -13.40875,26.65752 -40.4895,50.82956 -71.3728,63.70672 -25.27501,10.53871 -53.01346,14.62183 -87.5,12.88004 z" id="path3" />
            <path style="fill:#d4af37;fill-opacity:1;stroke-width:0.82404" d="m 219.88894,440.58521 c -14.26132,-15.87794 -26.30416,-40.48905 -30.91317,-63.17505 -2.34958,-11.56487 -2.103,-42.13531 0.43536,-53.9746 4.06987,-18.98247 12.0012,-37.96452 22.22115,-53.18188 4.39158,-6.539 19.34331,-24.27784 20.46332,-24.27784 0.23479,0 0.16369,8.80692 -0.15799,19.57094 l -0.58488,19.57094 -4.39636,7.74199 c -15.37653,27.07803 -19.27319,62.86797 -10.12963,93.03831 2.34861,7.74955 11.18513,25.56032 17.04824,34.3622 2.7171,4.079 7.38567,10.25794 10.37461,13.73097 2.98893,3.47304 5.43442,6.70089 5.43442,7.17301 0,0.47211 -1.20515,1.06414 -2.67812,1.31561 -2.83532,0.48405 -19.85765,2.08773 -22.17271,2.08889 -0.75114,3.8e-4 -2.97605,-1.79219 -4.94424,-3.98349 z" id="path4" />
            <path style="fill:#d4af37;fill-opacity:1;stroke-width:0.82404" d="m 223.61847,345.31957 c 0.61775,-8.78828 2.43544,-19.30352 3.7669,-21.79138 1.64346,-3.07084 20.69981,-11.00895 35.70769,-14.87439 9.95082,-2.56295 26.70871,-5.53006 27.38929,-4.84948 0.2288,0.2288 -1.78312,5.01755 -4.47094,10.64165 -2.68781,5.62411 -5.13146,11.20697 -5.43033,12.40637 -0.48656,1.95262 -1.71956,2.58787 -11.78837,6.07343 -12.90618,4.46778 -21.18468,8.01007 -35.5541,15.21324 l -10.17693,5.10154 z" id="path5" />
            <path style="fill:#d4af37;fill-opacity:1;stroke-width:0.82404" d="m 245.41472,298.00892 c -1.33437,-3.35751 -1.87987,-36.33848 -0.75911,-45.89555 4.51819,-38.52791 19.51488,-73.80029 44.6275,-104.96435 7.03164,-8.72607 34.63896,-36.19778 40.12021,-39.92313 l 3.4891,-2.37139 2.68793,2.06495 c 14.68843,11.28414 40.80039,39.83842 52.90289,57.85104 6.16972,9.18265 15.09561,25.77568 19.59618,36.42889 5.96592,14.12179 6.33876,13.45753 -4.43813,7.90727 -5.13608,-2.64516 -12.49027,-6.05745 -16.34265,-7.58288 -8.25503,-3.26873 -9.57647,-4.3361 -13.67364,-11.04459 -4.99379,-8.17659 -14.10626,-20.80002 -20.61394,-28.55633 -7.28332,-8.68077 -19.89521,-21.4221 -21.21149,-21.42919 -0.52121,-0.003 -3.86596,3.05644 -7.43279,6.79833 -39.08001,40.99804 -56.92927,84.93064 -53.99351,132.89482 0.38627,6.31086 0.43173,11.74371 0.10101,12.073 -0.33071,0.32929 -5.90958,2.24776 -12.39749,4.26325 l -11.7962,3.66455 z" id="path6" />
            <path style="fill:#d4af37;fill-opacity:1;stroke-width:0.82404" d="m 466.81846,318.33182 c -2.26611,-1.41632 -8.75542,-5.1512 -14.42069,-8.29973 -5.66527,-3.14853 -10.89481,-6.33412 -11.62118,-7.07909 -0.72639,-0.74497 -2.17804,-3.71455 -3.22591,-6.59909 -8.37483,-23.05386 -36.66002,-50.18925 -62.86662,-60.31105 -14.59844,-5.63838 -19.93454,-6.54346 -38.59168,-6.54574 -15.4361,-0.002 -17.7342,0.18645 -24.85677,2.03705 -4.31649,1.12151 -11.49532,3.49539 -15.95297,5.27527 -9.76118,3.89752 -9.66763,4.01626 -6.50575,-8.25765 2.41446,-9.37254 4.91269,-15.67145 6.92353,-17.45669 1.84771,-1.64039 11.28854,-4.34682 20.31879,-5.82484 27.70943,-4.53533 53.76095,-0.70473 78.28376,11.51079 13.38423,6.66706 23.09777,13.95617 36.69531,27.5364 16.18073,16.16013 24.49245,28.5499 32.34628,48.21663 4.17135,10.44542 8.25145,24.31478 7.86138,26.72286 -0.25217,1.55677 -0.50008,1.5045 -4.38748,-0.92512 z" id="path7" />
            <path style="fill:#d4af37;fill-opacity:1;stroke-width:0.82404" d="m 388.9983,367.91209 c -0.0606,-13.08838 -0.98643,-21.32731 -3.61949,-32.20892 l -1.91676,-7.92136 2.74434,-8.55943 c 5.17336,-16.13541 8.45617,-36.87641 8.49556,-53.6756 0.008,-3.2558 0.36474,-5.56227 0.8612,-5.56227 2.13266,0 18.59801,18.403 21.42731,23.9489 l 1.64824,3.23081 -1.67234,10.92532 c -3.93228,25.68948 -9.42692,42.40759 -23.76775,72.31628 l -4.14872,8.65242 z" id="path8" />
            <path style="fill:#d4af37;fill-opacity:1;stroke-width:0.82404" d="m 426.62677,478.65638 c -0.2476,-0.40063 4.72877,-6.00919 11.05861,-12.46346 10.88088,-11.0948 11.68284,-11.73505 14.69904,-11.73505 13.73433,0 44.42683,-8.59681 54.60598,-15.29485 3.92354,-2.58175 3.93624,-3.91156 0.13567,-14.20055 -9.52518,-25.7868 -21.61477,-44.11774 -40.14438,-60.86921 -10.91932,-9.87148 -27.67967,-19.80046 -40.12915,-23.77286 -6.58337,-2.10064 -6.69025,-2.24976 -5.19911,-7.25375 0.70062,-2.35115 2.11836,-7.61219 3.15052,-11.69119 1.22667,-4.84764 2.30559,-7.50305 3.11502,-7.66667 3.92575,-0.79355 31.20649,12.39472 42.75746,20.67014 33.66141,24.11592 55.52813,56.93584 64.54364,96.87398 2.85407,12.64342 2.7554,15.62098 -0.62435,18.84052 -10.36702,9.87557 -36.39572,21.26647 -59.94888,26.23533 -8.76742,1.84962 -13.074,2.23875 -28.93519,2.61453 -10.44714,0.24752 -18.83249,0.12146 -19.08488,-0.28691 z" id="path9" />
            <path style="fill:#d4af37;fill-opacity:1;stroke-width:0.82404" d="m 310.14829,497.40442 c -13.15559,-2.39875 -33.52963,-9.32696 -31.86451,-10.83556 0.3595,-0.32571 4.91805,-1.99137 10.1301,-3.70147 5.21205,-1.71011 12.81382,-4.55135 16.89281,-6.31386 l 7.41636,-3.20458 7.74062,0.97159 c 23.85125,2.99375 52.10147,-3.81566 72.19122,-17.40093 13.13881,-8.88483 28.60151,-24.52501 37.88663,-38.32148 9.90496,-14.71746 15.55736,-28.20407 18.06166,-43.09514 0.70995,-4.2215 1.50585,-8.02338 1.76867,-8.44864 0.82819,-1.34003 3.50009,0.7009 13.12778,10.02762 l 9.297,9.00639 -3.19396,8.84553 c -19.4611,53.89655 -59.70119,90.21181 -112.57575,101.59559 -11.74181,2.52799 -35.39188,2.96939 -46.87863,0.87494 z" id="path10" />
            <path style="fill:#d4af37;fill-opacity:1;stroke-width:0.82404" d="m 352.85056,456.46677 c -2.85706,-1.63815 -5.08197,-3.27158 -4.94424,-3.62987 0.37686,-0.98029 16.4103,-14.85982 17.16586,-14.85982 0.6874,0 19.91253,8.1239 20.41557,8.62694 0.48866,0.48867 -10.60732,6.66897 -16.89752,9.41168 -8.85017,3.85892 -9.75104,3.88474 -15.73967,0.45107 z" id="path11" />
            <path style="fill:#d4af37;fill-opacity:1;stroke-width:0.82404" d="m 307.6118,411.73216 c -9.14717,-7.63895 -15.46082,-15.67997 -18.83859,-23.99271 -4.27376,-10.51781 -4.41614,-27.6331 -0.33638,-40.4371 2.59994,-8.15971 13.02018,-28.62693 21.76026,-42.74105 10.47957,-16.92318 12.96766,-23.35697 13.41475,-34.68831 0.27319,-6.92389 0.013,-9.8024 -1.30269,-14.40884 -0.90425,-3.16604 -1.49835,-5.90217 -1.32022,-6.0803 0.80823,-0.80823 9.10562,5.516 13.37902,10.19743 5.51792,6.04478 9.36521,12.16472 11.94433,19.00003 1.61709,4.2857 1.84098,6.41213 1.8161,17.24893 l -0.0284,12.36059 -5.90837,17.30483 c -7.88661,23.09889 -8.72155,26.51982 -8.7911,36.01949 -0.0322,4.40118 -0.31753,7.73854 -0.63402,7.41636 -0.31649,-0.32218 -1.78437,-3.55233 -3.26196,-7.1781 -2.45296,-6.01916 -2.75634,-7.75655 -3.4894,-19.98296 -0.61199,-10.20721 -1.06404,-13.39065 -1.90145,-13.39065 -1.33133,0 -7.89544,8.80421 -12.88567,17.28308 -9.38134,15.93978 -11.68753,30.1168 -7.0784,43.51349 2.09198,6.08043 4.93527,10.80793 10.31281,17.14692 2.44249,2.87919 4.4409,5.42393 4.4409,5.65497 0,0.23105 -1.46573,1.16785 -3.25716,2.08177 l -3.25716,1.66168 z" id="path12" />
            <path style="fill:#d4af37;fill-opacity:1;stroke-width:0.82404" d="m 267.53909,367.7277 c -6.91774,-13.83928 -8.38422,-17.88827 -6.95558,-19.2045 1.37791,-1.26949 13.73171,-5.67535 14.30525,-5.10181 0.24422,0.24422 -0.008,2.80015 -0.56065,5.67985 -0.55257,2.8797 -1.0394,10.70536 -1.08182,17.39036 -0.0424,6.685 -0.11591,12.15457 -0.16329,12.15459 -0.0474,1e-5 -2.54214,-4.91331 -5.54391,-10.91849 z" id="path13" />
        </g>
    </symbol>
  </svg>

  <!-- MODULE CONTAINER -->
  <div class="module-frame max-w-5xl w-full rounded-xl overflow-hidden relative">
    
    <!-- Top Bar Decoration -->
    <div class="h-1 w-full bg-gradient-to-r from-transparent via-tctc-accent to-transparent opacity-50"></div>

    <div class="p-8 md:p-12">
      
      <!-- Header -->
      <div class="text-center mb-12">
        
        <!-- MAIN LOGO (Header) -->
        <svg class="mx-auto h-24 w-24 mb-8 opacity-90 hover:opacity-100 transition-all duration-500 drop-shadow-[0_0_15px_rgba(212,175,55,0.4)] hover:drop-shadow-[0_0_25px_rgba(212,175,55,0.6)]">
            <use href="#tctc-logo"></use>
        </svg>

        <div class="inline-block mb-3 px-3 py-1 border border-tctc-accent rounded-full text-[10px] text-tctc-accent tracking-[0.2em] uppercase bg-tctc-accent/5">
          System v1.0
        </div>
        <h1 class="text-3xl md:text-5xl font-bold mb-4 text-tctc-textMain font-serif tracking-tight">
          The Offer Architect
        </h1>
        <p class="text-tctc-textSub text-sm md:text-base max-w-xl mx-auto font-light">
          Input your raw materials. The system will construct the structural DNA of your offer, your delivery, and your influence.
        </p>
      </div>

      <!-- Input Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
        <div class="space-y-3 group">
          <div class="flex justify-between items-end">
            <label class="text-tctc-accent text-xs uppercase tracking-widest font-bold group-focus-within:text-tctc-textMain transition-colors">01. The Audience</label>
            <span class="text-[10px] text-tctc-textSub">Who are they?</span>
          </div>
          <textarea id="niche" placeholder="e.g., Burned out corporate lawyers seeking freedom..." class="architect-input"></textarea>
        </div>

        <div class="space-y-3 group">
          <div class="flex justify-between items-end">
            <label class="text-tctc-accent text-xs uppercase tracking-widest font-bold group-focus-within:text-tctc-textMain transition-colors">02. The Pain</label>
            <span class="text-[10px] text-tctc-textSub">The bleeding neck problem</span>
          </div>
          <textarea id="pain" placeholder="e.g., Golden handcuffs, high income but zero time..." class="architect-input"></textarea>
        </div>

        <div class="space-y-3 group">
          <div class="flex justify-between items-end">
            <label class="text-tctc-accent text-xs uppercase tracking-widest font-bold group-focus-within:text-tctc-textMain transition-colors">03. The Transformation</label>
            <span class="text-[10px] text-tctc-textSub">The desired future state</span>
          </div>
          <textarea id="transform" placeholder="e.g., Running a boutique firm working 20hrs/week..." class="architect-input"></textarea>
        </div>

        <div class="space-y-3 group">
          <div class="flex justify-between items-end">
            <label class="text-tctc-accent text-xs uppercase tracking-widest font-bold group-focus-within:text-tctc-textMain transition-colors">04. Your Strengths</label>
            <span class="text-[10px] text-tctc-textSub">Your leverage & resources</span>
          </div>
          <textarea id="strengths" placeholder="e.g., 10 years legal experience, certified yoga instructor..." class="architect-input"></textarea>
        </div>
      </div>

      <!-- Action Area -->
      <div class="flex flex-col items-center space-y-6 mb-8">
        <button onclick="generateOffer()" id="generateBtn"
          class="btn-gold w-full md:w-2/3 py-4 rounded text-sm md:text-base shadow-lg">
          Initialize Architecture
        </button>
      </div>

      <!-- Output Container -->
      <div id="outputContainer" class="hidden space-y-12 border-t border-tctc-border pt-12">
        
        <!-- Main Offer Result (THE PARCHMENT) -->
        <div class="relative">
          <div class="absolute -top-3 left-4 bg-tctc-primary px-2 text-tctc-accent text-xs font-bold tracking-widest uppercase border border-tctc-border rounded-sm z-10">
            Core Blueprint
          </div>
          
          <!-- The Container that will explode into existence -->
          <div id="mainResultContainer" class="rounded p-8 md:p-12 transition-all duration-500 hidden relative">
             
             <!-- --- BRANDING: WATERMARK LOGO --- -->
             <svg class="absolute top-4 right-4 h-10 w-10 text-tctc-gold opacity-60 drop-shadow-[0_0_5px_rgba(212,175,55,0.5)] pointer-events-none">
                <use href="#tctc-logo"></use>
             </svg>

             <!-- Header/Decor -->
             <div class="flex justify-between border-b border-[#3D2817]/30 pb-6 mb-6">
                <h2 class="text-2xl font-serif font-bold text-[#1A0F08] tracking-tight">The Structural Foundation</h2>
             </div>
             
             <!-- Text Area -->
             <div id="outputContent" class="parchment-text whitespace-pre-wrap text-sm md:text-base"></div>
             
             <!-- Actions -->
             <div id="mainActions" class="mt-10 flex gap-4 pt-6 border-t border-[#3D2817]/30 items-center opacity-0 transition-opacity duration-1000">
                <button onclick="copyToClipboard('outputContent')" class="btn-ink px-5 py-2 rounded text-xs uppercase tracking-wide">
                  Copy to Clipboard
                </button>
                <div class="flex-1"></div>
                <span class="text-[10px] text-[#3D2817] opacity-60 font-mono">OFFICIAL RECORD // TCTC</span>
             </div>
          </div>
        </div>

        <!-- GEMINI EXTENSIONS GRID -->
        
        <!-- 1. VISUAL SIGIL PROMPT (Full) -->
        <div class="col-span-1 lg:col-span-2 bg-gradient-to-br from-[var(--bg-secondary)] to-[var(--bg-primary)] border border-tctc-border p-8 relative group rounded hover:border-tctc-accent transition duration-500 flex flex-col items-center justify-center text-center">
           
           <div class="mb-6">
             <h3 class="text-tctc-accent font-serif text-2xl mb-2">The Visual Sigil</h3>
             <p class="text-tctc-textSub text-sm max-w-md mx-auto">
                Forge a "Master Prompt" for a high-status brand symbol. Use this in Midjourney, Dall-E, or Bing Image Creator.
             </p>
           </div>

           <!-- Prompt Result Container (Text) -->
           <div id="result-visual-container" class="hidden mb-6 relative rounded transition-all duration-500 relative w-full text-left">
               <!-- BRANDING: WATERMARK LOGO -->
               <svg class="absolute top-4 right-4 h-10 w-10 text-tctc-gold opacity-50 drop-shadow-[0_0_5px_rgba(212,175,55,0.5)] pointer-events-none">
                   <use href="#tctc-logo"></use>
               </svg>
               <!-- Content Area -->
               <div class="p-8 md:p-10 parchment-text whitespace-pre-wrap leading-relaxed text-sm md:text-base relative z-10">
               </div>
           </div>
           
           <!-- Actions (Hidden initially) -->
           <div id="visualActions" class="flex flex-wrap gap-4 opacity-0 transition-opacity duration-500 w-full justify-center items-center mt-4">
                <button onclick="copyToClipboard(document.querySelector('#result-visual-container .parchment-text').innerText)" class="btn-ink px-4 py-2 rounded text-xs uppercase tracking-wide flex items-center gap-2">
                   <span>Copy Prompt</span>
                </button>
                <a href="https://www.bing.com/images/create" target="_blank" class="btn-ink px-4 py-2 rounded text-xs uppercase tracking-wide flex items-center gap-2 hover:bg-[#3D2817] hover:text-[#F4ECD8]">
                   <span>Launch Bing</span>
                   <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                </a>
                <a href="https://firefly.adobe.com/" target="_blank" class="btn-ink px-4 py-2 rounded text-xs uppercase tracking-wide flex items-center gap-2 hover:bg-[#3D2817] hover:text-[#F4ECD8]">
                   <span>Launch Firefly</span>
                   <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                </a>
           </div>

           <button onclick="runGeminiPromptGen('sigil')" id="btn-visual" class="btn-gold px-8 py-3 rounded text-sm shadow-lg flex justify-center items-center gap-2 mt-4">
              <span>Generate Sigil Prompt</span>
           </button>
        </div>

        <!-- 2. ROW: Curriculum | Communications -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 w-full">
          
          <!-- Extension: Curriculum -->
          <div class="card-bg p-6 hover:border-tctc-accent transition duration-500 flex flex-col relative overflow-hidden group rounded">
            <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl text-tctc-accent font-serif group-hover:opacity-20 transition">1</div>
            <h3 class="text-tctc-textMain font-bold text-lg mb-2">Delivery Blueprint</h3>
            <p class="text-tctc-textSub text-xs mb-6 h-10">Generate the tactical 12-week execution plan required to fulfill the promise.</p>
            
            <!-- Result Container -->
            <div id="result-curriculum-container" class="hidden mb-4 rounded transition-all duration-500 relative">
                <!-- BRANDING -->
                <svg class="absolute top-2 right-2 h-8 w-8 text-tctc-gold opacity-40 drop-shadow-[0_0_5px_rgba(212,175,55,0.3)] pointer-events-none">
                    <use href="#tctc-logo"></use>
                </svg>
                <div id="result-curriculum" class="p-4 text-xs parchment-text whitespace-pre-wrap max-h-64 overflow-y-auto"></div>
            </div>
            
            <div class="mt-auto">
               <button onclick="runGeminiFeature('curriculum')" id="btn-curriculum" class="btn-secondary w-full py-2 text-xs rounded uppercase tracking-wider flex justify-center items-center gap-2">
                <span>Generate Curriculum</span>
              </button>
            </div>
          </div>

          <!-- Extension: Communications -->
          <div class="card-bg p-6 hover:border-tctc-accent transition duration-500 flex flex-col relative overflow-hidden group rounded">
            <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl text-tctc-accent font-serif group-hover:opacity-20 transition">2</div>
            <h3 class="text-tctc-textMain font-bold text-lg mb-2">Deploy Communications</h3>
            <p class="text-tctc-textSub text-xs mb-6 h-10">Generate high-status assets to test the offer in the market.</p>
            
            <!-- Result Container (Text) -->
            <div id="result-comms-container" class="hidden mb-4 rounded transition-all duration-500 relative">
                <!-- BRANDING -->
                <svg class="absolute top-2 right-2 h-8 w-8 text-tctc-gold opacity-40 drop-shadow-[0_0_5px_rgba(212,175,55,0.3)] pointer-events-none">
                    <use href="#tctc-logo"></use>
                </svg>
                <div id="result-comms" class="p-4 text-xs parchment-text whitespace-pre-wrap max-h-64 overflow-y-auto"></div>
            </div>

            <!-- Result Container (Social Image PROMPT) -->
            <div id="result-social-image-container" class="hidden mb-4 rounded transition-all duration-500 relative">
               <!-- BRANDING -->
               <svg class="absolute top-2 right-2 h-8 w-8 text-tctc-gold opacity-40 drop-shadow-[0_0_5px_rgba(212,175,55,0.3)] pointer-events-none">
                   <use href="#tctc-logo"></use>
               </svg>
               <div class="p-4 text-xs parchment-text whitespace-pre-wrap max-h-64 overflow-y-auto"></div>
            </div>
            
            <!-- Actions for Social Prompts (Hidden initially) -->
            <div id="socialPromptActions" class="hidden mb-4 flex flex-wrap gap-2 justify-center transition-opacity duration-500 w-full">
                <button onclick="copyToClipboard(document.querySelector('#result-social-image-container .parchment-text').innerText)" class="btn-ink px-3 py-1 rounded text-[10px] uppercase tracking-wide flex items-center gap-1">
                   <span>Copy</span>
                </button>
                <a href="https://www.bing.com/images/create" target="_blank" class="btn-ink px-3 py-1 rounded text-[10px] uppercase tracking-wide flex items-center gap-1 hover:bg-[#3D2817] hover:text-[#F4ECD8]">
                   <span>Bing</span>
                   <svg class="w-2 h-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                </a>
                 <a href="https://firefly.adobe.com/" target="_blank" class="btn-ink px-3 py-1 rounded text-[10px] uppercase tracking-wide flex items-center gap-1 hover:bg-[#3D2817] hover:text-[#F4ECD8]">
                   <span>Firefly</span>
                   <svg class="w-2 h-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                </a>
            </div>


            <div class="mt-auto grid grid-cols-2 gap-2">
              <button onclick="runGeminiFeature('linkedin')" id="btn-linkedin" class="btn-secondary py-2 text-xs rounded uppercase tracking-wider flex justify-center items-center">
                <span>LinkedIn Text</span>
              </button>
              <button onclick="runGeminiPromptGen('linkedin')" id="btn-linkedin-img" class="btn-secondary py-2 text-xs rounded uppercase tracking-wider flex justify-center items-center border-tctc-gold/30 text-tctc-gold/70 hover:text-tctc-gold">
                <span>Img Prompt</span>
              </button>
              
              <button onclick="runGeminiFeature('facebook')" id="btn-facebook" class="btn-secondary py-2 text-xs rounded uppercase tracking-wider flex justify-center items-center">
                <span>Facebook Text</span>
              </button>
              <button onclick="runGeminiPromptGen('facebook')" id="btn-facebook-img" class="btn-secondary py-2 text-xs rounded uppercase tracking-wider flex justify-center items-center border-tctc-gold/30 text-tctc-gold/70 hover:text-tctc-gold">
                <span>Img Prompt</span>
              </button>
            </div>
          </div>
        </div>

        <!-- 3. ROW: The Alchemy Script (Full) -->
        <div class="col-span-1 lg:col-span-2 bg-gradient-to-br from-[var(--bg-secondary)] to-[var(--bg-primary)] border border-tctc-border p-8 relative group rounded hover:border-tctc-accent transition duration-500">
            
            <div class="flex items-start justify-between mb-6">
                <div>
                    <h3 class="text-tctc-accent font-serif text-2xl mb-2">The Alchemy Script</h3>
                    <p class="text-tctc-textSub text-sm max-w-md">
                        Construct the <strong>Ignis, Aqua, Terra</strong> sales protocol.
                    </p>
                </div>
                <div class="hidden md:block text-right">
                    <div class="text-[10px] text-tctc-textSub uppercase tracking-widest">Source Material</div>
                    <div class="text-xs text-tctc-textSub font-serif italic">The Alchemy of Influence</div>
                </div>
            </div>
            
            <!-- Result Container -->
            <div id="result-alchemyScript" class="hidden mb-6 relative rounded transition-all duration-500 relative">
               <!-- BRANDING -->
               <svg class="absolute top-4 right-4 h-10 w-10 text-tctc-gold opacity-50 drop-shadow-[0_0_5px_rgba(212,175,55,0.5)] pointer-events-none">
                   <use href="#tctc-logo"></use>
               </svg>
               <!-- Content Area -->
               <div class="p-8 md:p-10 parchment-text whitespace-pre-wrap leading-relaxed text-sm md:text-base relative z-10">
               </div>
            </div>
            
            <button onclick="runGeminiFeature('alchemyScript')" id="btn-alchemyScript" class="btn-gold w-full py-3 rounded text-sm shadow-lg flex justify-center items-center gap-2">
              <span>Generate Alchemical Protocol</span>
            </button>
        </div>

      </div>

    </div>
    
    <!-- Bottom Bar Decoration -->
    <div class="h-1 w-full bg-[var(--bg-secondary)] border-t border-tctc-border"></div>
  </div>
  
  <div class="mt-6 text-tctc-textSub text-xs font-mono opacity-50">
      SECURE CONNECTION // TCTC SYSTEM
  </div>

  <script>
    async function callBackend(payload) {
      const maxRetries = 3;
      let delay = 1000;
      for (let i = 0; i < maxRetries; i++) {
        try {
          const res = await fetch("/api/generateOffer", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          if (!res.ok) {
            throw new Error(`API Error: ${res.status}`);
          }
          const data = await res.json();
          return data.offer;
        } catch (error) {
          if (i === maxRetries - 1) {
            throw error;
          }
          await new Promise(r => setTimeout(r, delay));
          delay *= 2;
        }
      }
    }

    // --- PROMPT GENERATION LOGIC (Cost Optimized) ---
    async function runGeminiPromptGen(type) {
        let btnId, containerId;
        // Social prompts share one container, sigil has its own
        const isSocial = (type === 'linkedin' || type === 'facebook');

        if (type === 'sigil') {
            btnId = 'btn-visual';
            containerId = 'result-visual-container';
        } else if (type === 'linkedin') {
            btnId = 'btn-linkedin-img';
            containerId = 'result-social-image-container';
        } else if (type === 'facebook') {
            btnId = 'btn-facebook-img';
            containerId = 'result-social-image-container';
        }

        const btn = document.getElementById(btnId);
        const offerText = document.getElementById("outputContent").innerText;
        
        if (!offerText) { alert("Please construct the offer first."); return; }

        // Toggle containers for social card
        if (isSocial) {
             document.getElementById('result-comms-container').classList.add('hidden');
             document.getElementById('socialPromptActions').classList.add('hidden'); // Hide previous actions
        }

        const originalHtml = btn.innerHTML;
        btn.innerHTML = `<div class="loader"></div>`;
        btn.disabled = true;

        try {
            const text = await callBackend({ promptType: type, offerText });
            
            // Scroll to container
            const container = document.getElementById(containerId);
            if (container) container.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Reveal magic and trigger action button fade-in
            if (type === 'sigil') {
                revealMagicalContent(containerId, text, 'visualActions');
            } else {
                // For social, reveal the special social actions bar
                const socialActions = document.getElementById('socialPromptActions');
                socialActions.classList.remove('hidden'); // Ensure it's display block first
                revealMagicalContent(containerId, text, 'socialPromptActions');
            }

        } catch (err) {
            console.error(err);
            alert("The Forge could not produce a prompt at this time.");
        } finally {
            btn.innerHTML = originalHtml;
            btn.disabled = false;
        }
    }

    // --- UNIFIED MAGICAL REVEAL FUNCTION ---
    function revealMagicalContent(containerId, textContent, actionButtonId = null) {
        const container = document.getElementById(containerId);
        if (!container) return;

        container.classList.remove("hidden");
        container.classList.remove("magical-reveal"); 
        container.classList.remove("parchment-box");
        
        // Handle text target properly
        // For prompt containers, we need to find the inner text div to preserve SVG
        // Let's look for the class .parchment-text specifically
        let textTarget = container.querySelector('.parchment-text');
        // Fallback: if container ITSELF is the text holder (legacy support)
        if (!textTarget && container.classList.contains('parchment-text')) textTarget = container;
        // Fallback 2: The social/visual containers have a div inside but maybe class missing on parent search?
        // In HTML: <div id="result-visual-container"> <svg> <div> </div> </div>
        if (!textTarget) textTarget = container.querySelector('div.parchment-text');

        if(textTarget) textTarget.innerHTML = ""; 

        if (actionButtonId) {
            const actions = document.getElementById(actionButtonId);
            if(actions) {
                actions.classList.remove("opacity-100");
                actions.classList.add("opacity-0");
            }
        }

        void container.offsetWidth; 
        container.classList.add("magical-reveal");

        setTimeout(() => {
            container.classList.add("parchment-box"); 
            if(textTarget) {
                typeWriter(textTarget, textContent, 0, "ember-text", () => {
                    if (actionButtonId) {
                        const actions = document.getElementById(actionButtonId);
                        if(actions) {
                            actions.classList.remove("opacity-0");
                            actions.classList.add("opacity-100");
                        }
                    }
                });
            }
        }, 1500);
    }

    async function generateOffer() {
      const niche = document.getElementById("niche").value;
      const pain = document.getElementById("pain").value;
      const transform = document.getElementById("transform").value;
      const strengths = document.getElementById("strengths").value;
      const btn = document.getElementById("generateBtn");
      const outputContainer = document.getElementById("outputContainer");

      if (!niche || !pain || !transform) {
        alert("Architecture requires raw materials. Please fill in the Niche, Pain, and Transformation.");
        return;
      }

      const originalText = btn.innerText;
      btn.innerText = "ARCHITECTING...";
      btn.disabled = true;
      btn.classList.add("opacity-70", "cursor-wait");
      outputContainer.classList.add("hidden"); 

      try {
        const offer = await callBackend({ niche, pain, transform, strengths });

        outputContent.innerText = offer; 
        outputContainer.classList.remove("hidden");
        outputContainer.classList.add("fade-in");
        
        setTimeout(() => {
             outputContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);

        revealMagicalContent("mainResultContainer", offer, "mainActions");

      } catch (error) {
        console.error(error);
        alert("System Malfunction. The Architect could not complete the request.");
      } finally {
        btn.innerText = originalText;
        btn.disabled = false;
        btn.classList.remove("opacity-70", "cursor-wait");
      }
    }

    async function runGeminiFeature(type) {
      let btnId = `btn-${type}`;
      let containerId = "";
      
      if (type === 'curriculum') containerId = "result-curriculum-container";
      else if (type === 'linkedin' || type === 'facebook') containerId = "result-comms-container";
      else if (type === 'alchemyScript') containerId = "result-alchemyScript";
      
      const btn = document.getElementById(btnId);
      
      if (document.getElementById("mainResultContainer").classList.contains("hidden")) {
         alert("Please construct the offer first.");
         return;
      }

      const offerText = document.getElementById("outputContent").innerText;

      const originalHtml = btn.innerHTML;
      btn.innerHTML = `<div class="loader"></div>`;
      btn.disabled = true;
      
      const container = document.getElementById(containerId);
      if(container) container.classList.add("hidden");
      
      // If switching to text in Comms card, hide the image prompt container and actions
      if (type === 'linkedin' || type === 'facebook') {
          document.getElementById('result-social-image-container').classList.add('hidden');
          document.getElementById('socialPromptActions').classList.add('hidden');
      }

      try {
        const text = await callBackend({ promptType: type, offerText });
        
        if (container) container.scrollIntoView({ behavior: 'smooth', block: 'center' });

        revealMagicalContent(containerId, text);

      } catch (err) {
        alert(err.message || "Extension Error");
      } finally {
        btn.innerHTML = originalHtml;
        btn.disabled = false;
      }
    }

    function typeWriter(element, text, index = 0, animateClass = null, callback = null) {
      if (index === 0) element.innerHTML = "";
      const chunkSize = animateClass ? 3 : 8; 
      const delay = animateClass ? 20 : 5; 
      if (index < text.length) {
        const chunk = text.slice(index, index + chunkSize);
        if (animateClass) {
            const span = document.createElement('span');
            span.className = animateClass;
            span.textContent = chunk;
            element.appendChild(span);
        } else {
            element.appendChild(document.createTextNode(chunk));
        }
        setTimeout(() => typeWriter(element, text, index + chunkSize, animateClass, callback), delay);
      } else {
          if (callback) callback();
      }
    }

    function copyToClipboard(text) {
      // Support passing text string directly or copying from implicit logic 
      // (Simplified for prompt actions to pass strings directly)
      navigator.clipboard.writeText(text).then(() => {
          // Optional: brief visual feedback could go here
      });
    }
  </script>
</body>
</html>
